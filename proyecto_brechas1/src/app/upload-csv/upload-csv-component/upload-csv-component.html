<div class="container">
  <h1>Gestión de Datos</h1>

  <!-- Pestañas -->
  <div class="tabs">
    <button [class.active]="activeTab === 'upload'" (click)="setActiveTab('upload')">
      Subir CSV
    </button>
    <button [class.active]="activeTab === 'api'" (click)="setActiveTab('api')">
      Conectar API
    </button>
  </div>

  <!-- Botón de navegación -->
  <div class="navigation-buttons" style="margin: 20px 0;">
    <button
      (click)="goToPriorizacion()"
      style="padding: 10px 20px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">
      Ir a Prioridad
    </button>
  </div>

  <!-- 📂 Pestaña: Subir CSV -->
  <div *ngIf="activeTab === 'upload'" class="tab-content">
    <h2>Subir Archivo CSV</h2>
    <input type="file" (change)="onFileSelected($event)" accept=".csv" />
    <button (click)="onUpload()" [disabled]="!selectedFile || progress > 0">
      Subir CSV
    </button>

    <!-- Barra de progreso -->
    <div *ngIf="progress > 0 && progress < 100" class="progress-bar">
      <div [style.width.%]="progress">{{ progress }}%</div>
    </div>

    <!-- 📊 Gráfica (render solo en navegador) -->
    <div class="chart-container" style="margin-top: 20px; height: 400px;">
      <div *ngIf="isBrowser">
        <canvas
          baseChart
          [data]="lineChartData"
          [options]="lineChartOptions"
          [type]="'line'">
        </canvas>
      </div>
    </div>
  </div>

  <!-- 🌐 Pestaña: API -->
  <div *ngIf="activeTab === 'api'" class="tab-content">
    <div *ngIf="isConnected; else notConnected">
      <h3>Obtener Indicadores</h3>
      <label for="topicId">ID del Tema (ej. 1, 2, 3, etc.):</label>
      <input id="topicId" type="text" [(ngModel)]="selectedTopicId" placeholder="Ej: 1" />
      <button (click)="fetchAPIData()" [disabled]="isLoading">
        {{ isLoading ? 'Cargando Datos...' : 'Obtener Datos API' }}
      </button>

      <!-- Datos obtenidos -->
      <div *ngIf="apiData.length > 0" style="margin-top: 20px;">
        <h3>Datos Obtenidos</h3>
        <pre>{{ apiData | json }}</pre>
      </div>
    </div>

    <ng-template #notConnected>
      <p>No hay conexión con la API.</p>
      <button (click)="checkAPIConnection()" [disabled]="isLoading">
        {{ isLoading ? 'Conectando...' : 'Probar Conexión API' }}
      </button>
    </ng-template>
  </div>
  <div>
    <!-- 🌍 Mapa -->
<app-mapa></app-mapa>
  </div>
</div>

